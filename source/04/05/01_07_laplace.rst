.. _sec_grid_creation_laplace:

Create grid shape solving Laplace equation
==============================================

Create grids by solving laplace equation.

Grids generated by this alogrithm consists of cells that are similar to
square, so it helps solvers do stable simulations.

An advantage of this algorithm is that there is no limitation about the
number of division lines in streamwise and cross section directions.
Because of this feature, user can use this algorithm to define grids with 
low-water channels, or for junctions of rivers.

:numref:`image_laplace_example_grid1` to :numref:`image_laplace_example_grid4`
shows examples of grids generated with the algorithm.

.. _image_laplace_example_grid1:

.. figure:: images/laplace_example_grid1.png
   :width: 300pt

   Example of a grid created by solving Laplace equation (1)

.. _image_laplace_example_grid2:

.. figure:: images/laplace_example_grid2.png
   :width: 300pt

   Example of a grid created by solving Laplace equation (2)

.. _image_laplace_example_grid3:

.. figure:: images/laplace_example_grid3.png
   :width: 300pt

   Example of a grid created by solving Laplace equation (3)

.. _image_laplace_example_grid4:

.. figure:: images/laplace_example_grid4.png
   :width: 300pt

   Example of a grid created by solving Laplace equation (4)

When this algorithm is selected, if a river survey data is imported,
The dialog in :numref:`image_laplace_select_control_xsec_dialog` is shown.

When you specify the number of Control Cross Sections and click on
[OK] button, center line is defined by using the river center lines
of river survey data, as shown in 
:numref:`image_laplace_centerline_example`.

If a river survey data is not imported, user can define the center line
with mouse operations.

.. _image_laplace_select_control_xsec_dialog:

.. figure:: images/laplace_select_control_xsec_dialog.png
   :width: 220pt

   [Specify the Number of Control Cross Sections] dialog

.. _image_laplace_centerline_example:

.. figure:: images/laplace_centerline_example.png
   :width: 360pt

   Example of center line

Next, please generate left bank line and right bank line. Select
[Build Left bank and Right bank lines] from menu.
[Build Bank Lines] dialog (:numref:`image_laplace_banks_dialog`) will
be shown. When you input the distance on the dialog and click on
[OK], Left bank line and Right bank line are generated, and shown
like in :numref:`image_laplace_banks_example`.

.. _image_laplace_banks_dialog:

.. figure:: images/laplace_banks_dialog.png
   :width: 200pt

   [Build Bank Lines] dialog

.. _image_laplace_banks_example:

.. figure:: images/laplace_banks_example.png
   :width: 340pt

   Example of generated Left bank line and Right bank line

After you defined left bank and right bank lines, you can edit the points,
or divide the region, if you need to.

When you've finished defining the region to generate grid, select the
following:

**Menu**: [Switch Mode] (S) --> [Division Setting Mode] (D)

Then, as shown in :numref:`image_laplace_dividesetting_example`,
the points where the grid nodes will be generated are shown on the 
lines.

.. _image_laplace_dividesetting_example:

.. figure:: images/laplace_dividesetting_example.png
   :width: 340pt

   Example of [Division Setting Mode] display

You can change the number of division for whole region, by selecting
the following:

**Menu**: [Grid] (G) --> [Grid Creating Condition] (G) --> [Division Setting for whole region] (W)

[Division Setting for Whole Region] dialog
(:numref:`image_laplace_divisionsetting_wholeregion_dialog`) will be shown,
so imput the numbers of divisions for streamwise direction and cross section direction,
and click on [OK] button.

.. _image_laplace_divisionsetting_wholeregion_dialog:

.. figure:: images/laplace_divisionsetting_wholeregion_dialog.png
   :width: 240pt

   [Division Setting for Whole Region] dialog

You can specify the number of divisions for each section individually.
To do that, please select the section line that you want to change the 
setting, and select the following:

**Menu**: [Grid] (G) --> [Grid Creating Condition] (G) --> [Division Setting] (D)

At last, select [Create Grid] from menu. Then, a grid is created from
the grid creating condition.

.. _image_laplace_grid_example:

.. figure:: images/laplace_grid_example.png
   :width: 360pt

   Example of generated grid

Menu items
--------------------

:numref:`laplace_menuitems_table_centeronly`,
:numref:`laplace_menuitems_table_regiondefined`, and
:numref:`laplace_menuitems_table_divisionsetting` 
shows the menu items for the submenu of [Grid] (G) -->
[Grid Creating Conditions] (G) when
[Create grid shape solving Laplace equation] is selected as
the grid creating algorithm. 

.. _laplace_menuitems_table_centeronly:

.. list-table:: Menu items (before building left bank and right bank lines)
   :header-rows: 1

   * - Menu
     - Description
   * - [Build Left bank and Right bank lines]
     - Generate Left bank and Right bank lines.
   * - [Add Vertex] (A)
     - Adds a vertex to the lines.
   * - [Remove Vertex] (R)
     - Removes a vertex from lines.
   * - [Edit Coordinates] (E)
     - Edits the coordinates.

.. _laplace_menuitems_table_regiondefined:

.. list-table:: Menu items for [Shape Edit Mode]
   :header-rows: 1

   * - Menu
     - Description
   * - [Build Left bank and Right bank lines]
     - Generate Left bank and Right bank lines.
   * - [Switch Mode] (S)
     - Switch mode between [Shape Edit Mode] and [Division Setting Mode].
   * - [Divide Region] (D)
     - Add a poly line inside the region to devide it.
   * - [Join regions] (J)
     - Remove the line currently selected, to join the two regions separated by that line.
   * - [Interpolation Mode] (I)
     - Switch the interpolation mode for the line currently selected, between [Spline] and [Linear].
   * - [Add Vertex] (A)
     - Adds a vertex to the lines.
   * - [Remove Vertex] (R)
     - Removes a vertex from lines.
   * - [Edit Coordinates] (E)
     - Edits the coordinates.

.. _laplace_menuitems_table_divisionsetting:

.. list-table:: Menu items for [Division Setting Mode]
   :header-rows: 1

   * - Menu
     - Description
   * - [Switch Mode] (S)
     - Switch mode between [Shape Edit Mode] and [Division Setting Mode].
   * - [Division Setting for whole region] (W)
     - Edit the division setting for whole region.
   * - [Division Setting] (D)
     - Edit the division setting for the line currently selected.
   * - [Points Deploying Setting] (P)
     - Edit the points deploying setting for the line currently selected.

[Build Left bank and Right bank lines]
----------------------------------------

**Description:** Generate Left bank and Right bank lines.

Dialog in :numref:`image_laplace_banks_dialog` is shown, so 
specify the distance values and click on [OK].

:numref:`image_laplace_banks_example` shows an example of 
generated [Left Bank Line] and [Right Bank Line].

You can modify the lines by dragging the vertices.

[Add Vertex] (A)
------------------

**Description:** Add vertices to lines

When you move the mouse cursor to hover on lines after
selecting this menu, the mouse cursor changes to the shape in 
:numref:`image_laplace_add_vertex_cursor`.

Left click on the line and drag it to add a new vertex.
The vertex is placed wherever you release the left click button.

.. _image_laplace_add_vertex_cursor:

.. figure:: images/laplace_add_vertex_cursor.png
   :width: 20pt

   The mouse cursor display when adding a vertex is possible

[Remove Vertex] (R)
---------------------

**Description:** Deletes the vertex of lines.

When this is selected and you move the cursor onto the vertex of the
lines, the cursor shape will change
(:numref:`image_laplace_remove_vertex_cursor`).
Left clicking will remove the vertex.

.. _image_laplace_remove_vertex_cursor:

.. figure:: images/laplace_remove_vertex_cursor.png
   :width: 20pt

   The mouse cursor when removing the vertex is possible

.. _subsec_laplace_editcoords:

[Edit Coordinates] (E)
------------------------

**Description:** Edits the coordinates of the line currently selected.

When you select the menu, the [Line Coordinates] dialog
(:numref:`image_laplace_coordinates_dialog`) will open.
Edit the coordinates and click on [OK].

.. _image_laplace_coordinates_dialog:

.. figure:: images/laplace_coordinates_dialog.png
   :width: 160pt

   [Line Coordinates] dialog

[Switch Mode] (S)
----------------------

**Description:** Switch mode between [Shape Edit Mode] and [Division Setting Mode].

In [Shape Edit Mode], user can edit the lines to define the region to generate grid.
The lines to define the region, and the points to edit the line shape are displayed.

In [Division Setting Mode], user can edit the setting about the grid division.
The lines to define the region, and points where the grid nodes will be generated are displayed.

:numref:`image_laplace_region_edit_mode_example` shows an example of
display in [Shape Edit Mode], and 
:numref:`image_laplace_division_setting_mode_example` shows an example of 
display in [Division Setting Mode], for each.

.. _image_laplace_region_edit_mode_example:

.. figure:: images/laplace_region_edit_mode_example.png
   :width: 350pt

   Example of [Shape Edit Mode]

.. _image_laplace_division_setting_mode_example:

.. figure:: images/laplace_division_setting_mode_example.png
   :width: 350pt

   Example of [Division Setting Mode]

[Divide Region] (D)
----------------------

**Description:** Add a poly line inside the region to devide it.

When in the mode to devine region, when user moves the mouse cursor
to the outer edge line of the region, the mouse cursor changes to
the shape in :numref:`image_laplace_add_vertex_cursor`.
When user clicks the left mouse button, a new point is created on the
line, and user can start defining new line.

User can add points to define a poly line, and when user moved the
mouse cursor to the edge on the other side, the mouse cursor 
changes to the shape in :numref:`image_laplace_add_vertex_cursor` again.
When user click the left mouse button, the definition of the new line
is finished, and the region is devided.

You can divide the region with arbitrary number of lines, both in
streamwise direction and cross section direction.

An example of before and after dividing a region is shown in 
:numref:`image_laplace_divide_region_before` and
:numref:`image_laplace_divide_region_after`.

.. _image_laplace_divide_region_before:

.. figure:: images/laplace_divide_region_before.png
   :width: 250pt

   Example of display before dividing a region
   
.. _image_laplace_divide_region_after:

.. figure:: images/laplace_divide_region_after.png
   :width: 250pt

   Example of display after dividing a region

[Join Regions] (J)
------------------------

**Description:** Remove the line currently selected, to join the two regions separated by that line.

To selec this menu, user have to select a line inside the region.

When user selec the menu, [Warning] dialog (:numref:`image_laplace_join_confirm_dialog`)
is shown. When user click on [Yes] button, joining regions is executed.

An example of before and after joining regions is shown in 
:numref:`image_laplace_join_region_before` and 
:numref:`image_laplace_join_region_after`.

.. _image_laplace_join_confirm_dialog:

.. figure:: images/laplace_join_confirm_dialog.png
   :width: 180pt

   [Warning] dialog

.. _image_laplace_join_region_before:

.. figure:: images/laplace_join_region_before.png
   :width: 250pt

   Example of display before joining regions

.. _image_laplace_join_region_after:

.. figure:: images/laplace_join_region_after.png
   :width: 250pt

   Example of display after joining regions

[Interpolation Mode] (I)
---------------------------

**Description:** Switch the interpolation mode for the line currently selected, between [Spline] and [Linear].

Example of [Spline] and [Linear] interpolation are shown in 
:numref:`image_laplace_interpolation_spline_example` and
:numref:`image_laplace_interpolation_linear_example`.

.. _image_laplace_interpolation_spline_example:

.. figure:: images/laplace_interpolation_spline_example.png
   :width: 250pt

   Example of [Spline] interpolation

.. _image_laplace_interpolation_linear_example:

.. figure:: images/laplace_interpolation_linear_example.png
   :width: 250pt

   Example of [Linear] interpolation

[Division Setting for whole region] (W)
-------------------------------------------

**Description:** Edit the division setting for whole region.

[Division Setting for Whole Region] dialog
(:numref:`image_laplace_divisionsetting_wholeregion_dialog`) is shown,
so input the number of divisions, and click on [OK] button.
In [dI] and [dJ], the average cell width in I-direction and J-direction
are displayed. 

[Division Setting] (D)
-------------------------------

**Description:** Edit the division setting for the line currently selected.

[Division Setting] dialog
(:numref:`image_laplace_divisionsetting_dialog`) is shown, 
so input the number of divisions, and click on [OK] button.

.. _image_laplace_divisionsetting_dialog:

.. figure:: images/laplace_divisionsetting_dialog.png
   :width: 120pt

   [Division Setting] dialog

[Points Deploying Setting] (P)
-------------------------------------

**Description:** Edit the points deploying setting for the line currently selected.

[Points Deploying Setting] dialog
(:numref:`image_laplace_deploysetting_dialog`) is shown,
so edit the points deploying setting, and click on [OK] button.

As shown on the dialog, the points deploying setting cah be selected from the followings:

- Equally divided
- Geometric division

Example of Equally divided and Geometric division are shown in
:numref:`image_laplace_deploy_equally_example` and 
:numref:`image_laplace_deploy_geometric_example`.

.. _image_laplace_deploysetting_dialog:

.. figure:: images/laplace_deploysetting_dialog.png
   :width: 180pt

   [Points Deploying Setting] dialog

.. _image_laplace_deploy_equally_example:

.. figure:: images/laplace_deploy_equally_example.png
   :width: 250pt

   Example of deployed points with [Equally divided] setting

.. _image_laplace_deploy_geometric_example:

.. figure:: images/laplace_deploy_geometric_example.png
   :width: 250pt

   Example of deployed points with [Geometric division] setting

[Reset to Default] (R)
----------------------

**Description**: Discards the grid creating conditions and restores the
default state.
