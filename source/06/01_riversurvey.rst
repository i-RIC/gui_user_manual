河川測量データ
=======================

河川測量データは、横断データ（左右岸のxy座標）と、
断面データ（左岸からの距離と河床高）からなるファイル形式です。

iRIC では、河川測量データは以下の2つの形式でインポートできます。

* 河川測量ファイル (\*.riv)
* 国土交通省 河川定期縦横断データ

それぞれのフォーマットについて以下に説明します。

河川測量ファイル（\*.riv）
--------------------------------

概要
~~~~~~~~~~

河川測量ファイル（\*.riv）は、横断データ（左右岸のxy座標）と、
断面データ（左岸からの距離と河床高）からなるファイル形式です。

河川測量ファイルはアスキー形式です。構造と概念を
:numref:`image_riv_structure`、 :numref:`image_riv_concept` に示します。

* 断面名、x座標値などの入力値の区切り文字は、半角スペース、タブ文字、
  改行文字となります。正しく区切られている場合、
  iRIC で自動的に値が認識されます。

* "#survey" 行以降が横断データとして認識されます。

  * 横断データは、1行について1断面の情報からなります。
  * データ行：（断面名）（左岸x座標値）（左岸y座標値）（右岸x座標値）（右岸y座標値）

* "#x-section" 行以降が断面データ（ヘッダ行、データ行から構成）として認識されます。

  * ヘッダ行：（断面名）（断面座標数）（指標1）（指標2）（指標3）（指標4）

  指標1～4は、断面座標の何番目の点かを整数(先頭が1)で指定します。指標1より前、
  指標4より後のデータは捨てられ、指標1で指定した点が左岸、指標4で指定した点が
  右岸に再設定されます。
  また、指標2, 指標3で指定された点には格子の分割点が自動的に設定されます。
  河川中心点は指標2と指標3の中点に設定されます。

  指標データは省略可能です。指標データを省略した場合には、断面座標データがすべて
  読み込まれ、断面座標データの最初の点が左岸、最後の点が右岸となります。
  河川中心点は左岸と右岸の中点に設定されます。
  なお、指標データがすべての断面に設定されていなかった場合、
  全断面の指標データが無視されます。

  * データ行：（左岸からの距離）（河床高）・・・以降、断面座標数分繰り返してください。
    1行に5点まで「左岸からの距離」と「河床高」の断面座標の組が記述できます。

.. _image_riv_structure:

.. figure:: images/riv_structure.png
   :width: 400pt

   河川測量ファイルの構造

.. _image_riv_concept:

.. figure:: images/riv_concept.png
   :width: 420pt

   河川測量ファイルデータの概念

:numref:`image_riv_concept` は河川測量ファイルデータの概念を
表したものであり、iRICでは指標データの４つの丸印は表示されません。

iRIC の横断面ウィンドウで表示される横断方向の座標は
以下のように変換されたものであり、
河川測量ファイルの断面データにおける「左岸からの距離」とは異なります。

* 横断データと断面データから河川中心点の座標を求める。
* 河川中心点からの横断線上の距離を求める。


国土交通省 河川定期縦横断データ
------------------------------------

概要
~~~~~~~

以下の2種類のファイルを準備します。

* 横断測線の平面位置データ (19座標系のみ)
* 横断面形状データ (国土交通省フォーマット)

それぞれのフォーマットは以下の通りです。

横断測線の平面位置データ (19座標系のみ)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

横断測線の位置は左右岸の基準点座標から構成されます。基準点座標は19系座標で指定する必要があります。

19座標系は以下を参照ください。

https://www.gsi.go.jp/sokuchikijun/jpc.html

以下の列から構成される CSV ファイルです。

* KP: 海からの距離
* LX: 左岸のX座標(北向きが正)
* LY: 左岸のY座標(東向きが正)
* RX: 右岸のX座標(北向きが正)
* RY: 右岸のY座標(東向きが正)

データファイル例を :numref:`plane_example` に示します。

.. code-block:: text
   :name: plane_example
   :caption: 平面における断面位置 例

   KP,LX,LY,RX,RY
   137.0,-30014.658 ,-5806.715 ,-29777.485 ,-5770.361 
   137.5,-30112.423 ,-5339.822 ,-29788.809 ,-5308.140 


横断面形状データ (国土交通省フォーマット)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

横断面形状データは、国土交通省が平成20年に「河川定期縦横断データ作成ガイドライン 」
で指定したフォーマットに準拠しています。データフォーマットは、「河川定期縦横断データ作成ガイドライン」の
13, 14 ページを参照ください。

https://www.mlit.go.jp/river/shishin_guideline/kasen/gis/pdf_docs/juoudan/guideline0805.pdf

iRIC では、構造物フラグが 0 (構造物なし) の断面データにのみ対応しています。

データファイル例を :numref:`mlit_example` に示します。

.. code-block:: text
   :name: mlit_example
   :caption: 断面の横断形状 例

   137.000,0.000,67.953,76.607,64.189,72.213,130,0.000,0.000,0.000,0.000,0,20100127,8101030001,石狩川水系,石狩川,
   0,-193.860,68.900,
   0,0.000,67.953,
   0,310.430,76.220,

.. note:: 

   - 横断測量データは各河川の管理者（河川事務所）で保管されています。
   - 横断測線の平面位置データ (19座標系のみ)について
     - 横断測線の平面位置データ (19座標系のみ)は、上記「河川定期縦横断データ作成ガイドライン」で規定されていないため、管理者ごとにデータ・フォーマットが異なる場合があります。

   - 横断形状データについて
     - 平成20年以降、上記「河川定期縦横断データ作成ガイドライン」に準拠して作成されているはずです。
     - ただし平成20年以前の横断測量データは管理者ごとにフォーマットが異なる場合があります。
   
インポート時のエラーメッセージについて
---------------------------------------

under construction
